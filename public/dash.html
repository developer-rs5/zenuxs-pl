<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdvanceAuth Dashboard - Zenuxs</title>
    <link rel="shortcut icon" href="/images/zenux.png" type="image/x-icon">

    <!-- Stylesheets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

    <!-- Dark Theme with Hash Routing Support -->
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #475569;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .login-form {
            background: var(--bg-secondary);
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            border: 1px solid var(--border);
        }

        .login-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: var(--text-primary);
            font-size: 2.2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .timezone-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            justify-content: center;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            width: 100%;
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .social-links {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
        }

        .social-links a:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* ===== DASHBOARD CONTAINER ===== */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .dashboard-container.active {
            display: block;
        }

        /* ===== SIDEBAR NAVIGATION ===== */
        .sidebar {
            width: 250px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px 0;
            overflow-y: auto;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header p {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .nav-links {
            list-style: none;
            padding: 0 10px;
        }

        .nav-links li {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        .nav-section {
            padding: 15px 20px 5px;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .server-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin: 20px;
            font-size: 0.9rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: 250px;
            padding: 0;
            min-height: 100vh;
        }

        .topbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .topbar-left h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* ===== PAGE CONTENT ===== */
        .page-content {
            padding: 30px;
            display: none;
        }

        .page-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-header h1 {
            color: var(--text-primary);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 5px;
            line-height: 1;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* ===== CHARTS ===== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            height: 350px;
            min-height: 350px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ===== TABLES ===== */
        .table-container {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 16px 25px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            position: sticky;
            top: 0;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        /* ===== FEATURES GRID ===== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .feature-desc {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        /* ===== FORM STYLES ===== */
        .form-card {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-end;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* ===== DISCORD POPUP ===== */
        .discord-popup {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            width: 350px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.5s forwards;
        }

        @keyframes slideUp {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .discord-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .discord-popup-header h4 {
            color: var(--text-primary);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .discord-popup-content {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .discord-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: #5865F2;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .discord-btn:hover {
            background: #4752c4;
            transform: translateY(-2px);
        }

        .close-popup {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            transition: color 0.3s;
        }

        .close-popup:hover {
            color: var(--text-primary);
        }

        /* ===== LOADING & TOAST ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            z-index: 1100;
            font-weight: 500;
            max-width: 400px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--info);
        }

        /* ===== BUTTON VARIANTS ===== */
        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 6px;
        }

        .btn-xs {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
        }

        .btn-primary {
            background: var(--primary);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-info {
            background: var(--info);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        /* ===== STATUS BADGES ===== */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-banned {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .topbar {
                padding: 15px;
            }

            .page-content {
                padding: 20px;
            }

            .discord-popup {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 20px;
            }

            th,
            td {
                padding: 12px 15px;
            }
        }

        @media (max-width: 480px) {
            .login-form {
                padding: 30px 20px;
            }

            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .table-actions {
                flex-wrap: wrap;
            }
        }

        /* ===== CUSTOM SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* ===== PAGINATION ===== */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Add these styles to fix the email form and enhance API key management */

        /* Fixed form input styling */
        .form-row-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 20px;
            align-items: end;
        }

        .form-row-grid-2 {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 20px;
            align-items: end;
        }

        .form-row-grid .form-group,
        .form-row-grid-2 .form-group {
            margin-bottom: 0;
        }

        .form-row-grid input,
        .form-row-grid-2 input {
            width: 100% !important;
            min-width: 200px;
        }

        /* API key table styling */
        .api-key-cell {
            font-family: monospace;
            font-size: 12px;
            background: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Status badges */
        .status-expired {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-revoked {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Modal for new API key display */
        .api-key-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .api-key-modal-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }

        .api-key-display {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            color: var(--success);
            margin: 15px 0;
            word-break: break-all;
            text-align: center;
            border: 1px solid var(--success);
        }

        .warning-text {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--warning);
            margin: 10px 0;
        }

        /* Copy button */
        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px auto;
        }

        .copy-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }

        .copy-btn.copied {
            background: var(--success);
        }

        /* Permission checkboxes */
        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .permission-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .permission-checkbox:hover {
            background: var(--bg-primary);
        }

        .permission-checkbox input[type="checkbox"] {
            margin: 0;
        }

        .permission-checkbox span {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive fixes for forms */
        @media (max-width: 768px) {

            .form-row-grid,
            .form-row-grid-2 {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-row-grid .btn,
            .form-row-grid-2 .btn {
                width: 100%;
            }

            .api-key-cell {
                max-width: 100px;
                font-size: 10px;
            }
        }

        @media (max-width: 480px) {
            .permissions-grid {
                grid-template-columns: 1fr;
            }

            .api-key-modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- ===== LOGIN SCREEN ===== -->
    <div id="login" class="login-container">
        <div class="login-form">
            <div class="logo">
                <h1><i class="fas fa-shield-alt"></i> AdvanceAuth</h1>
                <p>by <strong>DEVELOPER.RS (Rishabh)</strong> â€¢ Zenuxs Plugins</p>
                <div class="timezone-indicator">
                    <i class="fas fa-globe-asia"></i> Timezone: IST (UTC+5:30)
                </div>
            </div>

            <div class="form-group">
                <label for="serverKey"><i class="fas fa-key"></i> Server Key</label>
                <input type="text" id="serverKey" class="form-control" placeholder="Enter your server key">
            </div>

            <div class="form-group">
                <input type="hidden" id="apiEndpoint" class="form-control" value="https://plugins.zenuxs.in">
            </div>

            <button class="btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Access Dashboard
            </button>

            <div style="margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                <p style="font-size: 14px; color: var(--text-secondary); text-align: center;">
                    <i class="fas fa-bolt"></i> Enhanced with caching & Indian timezone
                </p>
            </div>

            <div class="social-links">
                <a href="https://zenuxs.in" target="_blank" title="Website">
                    <i class="fas fa-globe"></i>
                </a>
                <a href="https://discord.zenuxs.in" target="_blank" title="Discord">
                    <i class="fab fa-discord"></i>
                </a>
                <a href="https://instagram.com/zenuxs" target="_blank" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://youtube.com/@zenuxs" target="_blank" title="YouTube">
                    <i class="fab fa-youtube"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div id="dashboard" class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-shield-alt"></i> AdvanceAuth</h2>
                <p>Advanced Authentication System</p>
                <div class="timezone-indicator" style="margin-top: 10px;">
                    <i class="fas fa-clock"></i> IST Timezone
                </div>
            </div>

            <div class="server-status">
                <div class="status-indicator"></div>
                <span id="serverStatus">Loading...</span>
            </div>

            <ul class="nav-links">
                <li class="nav-section">DASHBOARD</li>
                <li><a href="#home" class="nav-link active" data-page="home">
                        <i class="fas fa-home"></i> Overview
                    </a></li>
                <li><a href="#stats" class="nav-link" data-page="stats">
                        <i class="fas fa-chart-line"></i> Analytics
                    </a></li>
                <li><a href="#users" class="nav-link" data-page="users">
                        <i class="fas fa-users"></i> Users
                    </a></li>

                <!-- <li class="nav-section">MANAGEMENT</li>
                <li><a href="#licenses" class="nav-link" data-page="licenses">
                        <i class="fas fa-key"></i> Licenses
                    </a></li>
                <li><a href="#serverkeys" class="nav-link" data-page="serverkeys">
                        <i class="fas fa-server"></i> Server Keys
                    </a></li> -->

                <li class="nav-section">NEW FEATURES</li>
                <li><a href="#email" class="nav-link" data-page="email">
                        <i class="fas fa-envelope"></i> Email System
                    </a></li>
                <li><a href="#api" class="nav-link" data-page="api">
                        <i class="fas fa-code"></i> Public API
                    </a></li>
                <li><a href="#system" class="nav-link" data-page="system">
                        <i class="fas fa-cog"></i> System Info
                    </a></li>
            </ul>

            <div style="padding: 20px; margin-top: auto;">
                <button class="btn btn-danger btn-sm" id="logoutBtn" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="topbar-left">
                    <h3 id="pageTitle">Dashboard Overview</h3>
                </div>
                <div class="topbar-right">
                    <div style="font-size: 14px; color: var(--text-secondary);">
                        <i class="fas fa-clock"></i> <span id="currentTime">Loading...</span>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>

            <!-- Page Content -->
            <div class="page-content active" id="page-home">
                <div class="page-header">
                    <h1>Dashboard Overview</h1>
                    <p>Welcome to AdvanceAuth Admin Panel - All data in IST timezone</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-change positive" id="userChange">
                            <i class="fas fa-arrow-up"></i> Loading...
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info);">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div class="stat-value" id="loggedInToday">0</div>
                        <div class="stat-label">Active Today</div>
                        <div class="stat-change positive" id="loginChange">
                            <i class="fas fa-history"></i> Real-time
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="stat-value" id="newRegistrations">0</div>
                        <div class="stat-label">New Registrations (30d)</div>
                        <div class="stat-change positive" id="regChange">
                            <i class="fas fa-chart-line"></i> Tracking
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-user-times"></i>
                        </div>
                        <div class="stat-value" id="bannedUsers">0</div>
                        <div class="stat-label">Banned Users</div>
                        <div class="stat-change negative" id="banChange">
                            <i class="fas fa-exclamation-triangle"></i> Monitor
                        </div>
                    </div>
                </div>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="feature-title">Enhanced Performance</div>
                        <div class="feature-desc">
                            Multi-layer caching system with 3x faster data retrieval. All timestamps in IST.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-mail-bulk"></i>
                        </div>
                        <div class="feature-title">External Email System</div>
                        <div class="feature-desc">
                            Integrated with nodemailer-five-sigma.vercel.app for OTPs and notifications.
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="feature-title">Public API</div>
                        <div class="feature-desc">
                            Rate-limited API endpoints for external applications with 100 requests/15min.
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">Login Activity (24h)</div>
                                <div class="chart-subtitle">Hourly login trends in IST</div>
                            </div>
                        </div>
                        <canvas id="loginChart24h"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">User Registrations</div>
                                <div class="chart-subtitle">Last 30 days in Indian timezone</div>
                            </div>
                        </div>
                        <canvas id="registrationChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Stats Page -->
            <div class="page-content" id="page-stats">
                <div class="page-header">
                    <h1>Advanced Analytics</h1>
                    <p>Detailed statistics and performance metrics</p>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">Weekly Activity</div>
                                <div class="chart-subtitle">Last 7 days login patterns</div>
                            </div>
                        </div>
                        <canvas id="weeklyChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <div>
                                <div class="chart-title">Monthly Overview</div>
                                <div class="chart-subtitle">30-day user engagement</div>
                            </div>
                        </div>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="stat-value" id="peakHour">--:--</div>
                        <div class="stat-label">Peak Login Hour</div>
                        <div class="stat-change positive">
                            <i class="fas fa-clock"></i> IST Timezone
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-value" id="retentionRate">0%</div>
                        <div class="stat-label">7-Day Retention</div>
                        <div class="stat-change positive">
                            <i class="fas fa-users"></i> Active users
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info);">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stat-value" id="cacheHit">0%</div>
                        <div class="stat-label">Cache Efficiency</div>
                        <div class="stat-change positive">
                            <i class="fas fa-bolt"></i> Performance
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div class="page-content" id="page-users">
                <div class="page-header">
                    <h1>User Management</h1>
                    <p>Manage registered users and their permissions</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            <i class="fas fa-users"></i> Registered Users
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" id="refreshUsersBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-success btn-sm" id="exportUsersBtn">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Registered (IST)</th>
                                    <th>Last Login (IST)</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="6"
                                        style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <i class="fas fa-spinner fa-spin"></i> Loading users...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="usersPagination"></div>
                </div>
            </div>

            <!-- Licenses Page -->
            <!-- <div class="page-content" id="page-licenses">
                <div class="page-header">
                    <h1>License Management</h1>
                    <p>Manage and monitor license keys</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            <i class="fas fa-key"></i> Active Licenses
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="loadLicenses()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-success btn-sm" onclick="showCreateLicenseModal()">
                                <i class="fas fa-plus"></i> Create
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>License Key</th>
                                    <th>Type</th>
                                    <th>Valid Until</th>
                                    <th>Max Servers</th>
                                    <th>Used Servers</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="licensesTableBody">
                                <tr>
                                    <td colspan="7"
                                        style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <i class="fas fa-spinner fa-spin"></i> Loading licenses...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> -->

            <!-- Update the Email Section (fixing the small input boxes) -->
            <div class="page-content" id="page-email">
                <div class="page-header">
                    <h1>Email System</h1>
                    <p>Manage email settings and password reset functionality</p>
                </div>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="feature-title">Email Configuration</div>
                        <div class="feature-desc">
                            Connected to external nodemailer server at: nodemailer-five-sigma.vercel.app
                        </div>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="feature-title">Password Reset</div>
                        <div class="feature-desc">
                            OTP-based password reset system with 10-minute expiry.
                        </div>
                    </div>
                </div>

                <!-- FIXED FORM STYLES -->
                <div class="form-card">
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">
                        <i class="fas fa-cogs"></i> Email Management
                    </h3>

                    <!-- Set User Email - FIXED STYLING -->
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 10px; color: var(--text-secondary);">
                            <i class="fas fa-user-edit"></i> Set User Email
                        </label>
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 20px;">
                            <div>
                                <input type="text" id="setmailUsername" class="form-control"
                                    placeholder="Enter username" style="width: 100%;">
                            </div>
                            <div>
                                <input type="email" id="setmailEmail" class="form-control"
                                    placeholder="Enter email address" style="width: 100%;">
                            </div>
                            <button class="btn btn-primary" id="setmailBtn" style="white-space: nowrap;">
                                <i class="fas fa-save"></i> Set Email
                            </button>
                        </div>
                    </div>

                    <!-- Reset Password via Email - FIXED STYLING -->
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 10px; color: var(--text-secondary);">
                            <i class="fas fa-key"></i> Reset Password via Email
                        </label>
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-bottom: 20px;">
                            <div>
                                <input type="email" id="resetEmail" class="form-control"
                                    placeholder="Enter registered email" style="width: 100%;">
                            </div>
                            <button class="btn btn-warning" id="requestOTPBtn" style="white-space: nowrap;">
                                <i class="fas fa-paper-plane"></i> Send OTP
                            </button>
                        </div>
                    </div>

                    <!-- OTP Section -->
                    <div id="otpSection"
                        style="display: none; margin-top: 20px; padding: 20px; background: var(--bg-tertiary); border-radius: 8px;">
                        <h4 style="color: var(--text-primary); margin-bottom: 15px;">
                            <i class="fas fa-shield-alt"></i> Verify OTP
                        </h4>
                        <div style="display: grid; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                                    6-digit OTP Code
                                </label>
                                <input type="text" id="otpCode" class="form-control" placeholder="Enter OTP from email"
                                    maxlength="6" style="width: 100%;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                                    New Password
                                </label>
                                <input type="password" id="newPassword" class="form-control"
                                    placeholder="Enter new password" style="width: 100%;">
                            </div>
                            <button class="btn btn-success" id="verifyOTPBtn">
                                <i class="fas fa-check"></i> Verify & Change Password
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Update the API Section to include API Key Management -->
            <div class="page-content" id="page-api">
                <div class="page-header">
                    <h1>Public API Access</h1>
                    <p>API documentation and key management</p>
                </div>

                <!-- API Key Management Section -->
                <div class="table-container" style="margin-bottom: 30px;">
                    <div class="table-header">
                        <div class="table-title">
                            <i class="fas fa-key"></i> API Key Management
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" id="refreshApiKeysBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-success btn-sm" id="generateApiKeyBtn">
                                <i class="fas fa-plus"></i> Generate New
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>API Key Name</th>
                                    <th>Key (Partial)</th>
                                    <th>Permissions</th>
                                    <th>Rate Limit</th>
                                    <th>Created</th>
                                    <th>Expires</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="apiKeysTableBody">
                                <tr>
                                    <td colspan="8"
                                        style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <i class="fas fa-spinner fa-spin"></i> Loading API keys...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Generate API Key Form -->
                <div class="form-card" style="margin-bottom: 30px;">
                    <h3 style="color: var(--text-primary); margin-bottom: 20px;">
                        <i class="fas fa-key"></i> Generate New API Key
                    </h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                                API Key Name
                            </label>
                            <input type="text" id="apiKeyName" class="form-control"
                                placeholder="e.g., My App Integration" style="width: 100%;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                                Rate Limit (requests/15min)
                            </label>
                            <input type="number" id="apiKeyRateLimit" class="form-control" value="100" min="10"
                                max="1000" style="width: 100%;">
                        </div>

                        <div>
                            <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                                Expiry Days
                            </label>
                            <input type="number" id="apiKeyExpiryDays" class="form-control" value="30" min="1" max="365"
                                style="width: 100%;">
                        </div>

                        <div style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" id="createApiKeyBtn" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Generate API Key
                            </button>
                        </div>
                    </div>

                    <!-- Permissions Selection -->
                    <div style="margin-top: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-secondary);">
                            Permissions
                        </label>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 5px; color: var(--text-secondary);">
                                <input type="checkbox" id="permPublicQuery" checked disabled>
                                <span>public_query</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; color: var(--text-secondary);">
                                <input type="checkbox" id="permReadUsers">
                                <span>read_users</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; color: var(--text-secondary);">
                                <input type="checkbox" id="permReadStats">
                                <span>read_stats</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- API Documentation -->
                <div class="feature-card" style="margin-bottom: 20px;">
                    <div class="feature-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <div class="feature-title">Public API Endpoint</div>
                    <div class="feature-desc">
                        Rate-limited API endpoint for external applications. 100 requests per 15 minutes per IP.
                    </div>
                </div>

                <div class="form-card">
                    <h4 style="color: var(--text-primary); margin-bottom: 15px;">
                        <i class="fas fa-link"></i> Endpoint: /api/dataapikey/query
                    </h4>

                    <div
                        style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-family: monospace; color: var(--text-secondary);">
                        GET
                        https://plugins.zenuxs.in/api/dataapikey/query?tag=username&password=pass&apikey=YOUR_API_KEY
                    </div>

                    <h5 style="color: var(--text-primary); margin: 15px 0;">Parameters:</h5>
                    <ul style="color: var(--text-secondary); padding-left: 20px; margin-bottom: 20px;">
                        <li><code>tag</code>: Username (required)</li>
                        <li><code>password</code>: User password (required)</li>
                        <li><code>apikey</code>: Your API key (required for access)</li>
                        <li><code>serverKey</code>: Optional server key for specific server</li>
                    </ul>

                    <h5 style="color: var(--text-primary); margin: 15px 0;">Response Example:</h5>
                    <pre
                        style="background: var(--bg-primary); padding: 15px; border-radius: 8px; color: var(--text-secondary); overflow-x: auto; font-size: 12px;">
{
    "valid": true,
    "exists": true,
    "username": "testuser",
    "isBanned": false,
    "timestamp": "23/01/2025, 14:30:45",
    "indianTime": "23/01/2025, 14:30:45",
    "serverTime": "23/01/2025, 14:30:45",
    "timezone": "IST (UTC+5:30)"
}</pre>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <h5 style="color: var(--text-primary); margin-bottom: 15px;">
                            <i class="fas fa-key"></i> Generate API Key
                        </h5>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" id="apiKeyName" class="form-control" placeholder="API Key Name">
                            </div>
                            <button class="btn btn-primary" id="generateApiKeyBtn">
                                <i class="fas fa-plus"></i> Generate Key
                            </button>
                        </div>
                    </div>
                </div>
            </div>



            <!-- System Info Page -->
            <div class="page-content" id="page-system">
                <div class="page-header">
                    <h1>System Information</h1>
                    <p>System configuration and performance metrics</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="stat-value" id="systemVersion">2.0.0</div>
                        <div class="stat-label">System Version</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info);">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-value" id="totalServers">0</div>
                        <div class="stat-label">Total Servers</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="systemUptime">0h</div>
                        <div class="stat-label">System Uptime</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="stat-value" id="activeLicenses">0</div>
                        <div class="stat-label">Active Licenses</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            <i class="fas fa-info"></i> System Details
                        </div>
                    </div>
                    <table>
                        <tbody>
                            <tr>
                                <td><strong>Plugin Name</strong></td>
                                <td>AdvanceAuth</td>
                            </tr>
                            <tr>
                                <td><strong>Company</strong></td>
                                <td>Zenuxs</td>
                            </tr>
                            <tr>
                                <td><strong>Developer</strong></td>
                                <td>DEVELOPER.RS (Rishabh)</td>
                            </tr>
                            <tr>
                                <td><strong>Website</strong></td>
                                <td><a href="https://rs.zenuxs.xyz" target="_blank"
                                        style="color: var(--primary);">https://rs.zenuxs.xyz</a></td>
                            </tr>
                            <tr>
                                <td><strong>Timezone</strong></td>
                                <td>IST (Asia/Kolkata) - UTC+5:30</td>
                            </tr>
                            <tr>
                                <td><strong>Total System Users</strong></td>
                                <td id="systemTotalUsers">0</td>
                            </tr>
                            <tr>
                                <td><strong>Cache Status</strong></td>
                                <td id="cacheStatus">Active</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Server Keys Page -->
            <div class="page-content" id="page-serverkeys">
                <div class="page-header">
                    <h1>Server Key Management</h1>
                    <p>Manage server keys and their permissions</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">
                            <i class="fas fa-server"></i> Server Keys
                        </div>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="loadServerKeys()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Server Key</th>
                                    <th>Name</th>
                                    <th>Owner</th>
                                    <th>Max Users</th>
                                    <th>Current Users</th>
                                    <th>Status</th>
                                    <th>Plugin</th>
                                </tr>
                            </thead>
                            <tbody id="serverKeysTableBody">
                                <tr>
                                    <td colspan="7"
                                        style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <i class="fas fa-spinner fa-spin"></i> Loading server keys...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== DISCORD POPUP ===== -->
    <div id="discordPopup" class="discord-popup" style="display: none;">
        <div class="discord-popup-header">
            <h4><i class="fab fa-discord" style="color: #5865F2;"></i> Join Our Community</h4>
            <button class="close-popup" id="closeDiscordPopup">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="discord-popup-content">
            <p>ðŸš€ Support AdvanceAuth development! Join our Discord community for:</p>
            <ul style="margin: 10px 0 10px 20px; color: var(--text-secondary);">
                <li>Priority support</li>
                <li>Latest updates</li>
                <li>Feature requests</li>
                <li>Community help</li>
            </ul>
        </div>
        <a href="https://discord.zenuxs.in" target="_blank" class="discord-btn">
            <i class="fab fa-discord"></i> Join Discord
        </a>
    </div>

    <!-- ===== LOADING OVERLAY ===== -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <!-- ===== TOAST ===== -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentServerKey = '';
        let apiEndpoint = '';
        let currentPage = 1;
        let charts = {};
        let userData = [];
        let currentSection = 'home';

        // Initialize on page load
        window.addEventListener('load', function () {
            console.log('ðŸš€ AdvanceAuth Dashboard v2.0.0');
            console.log('â° Timezone: IST (Asia/Kolkata)');
            console.log('ðŸ“§ Email: External Nodemailer Integration');
            console.log('ðŸ”— Discord: https://discord.zenuxs.in');

            // Load saved settings
            const savedEndpoint = sessionStorage.getItem('apiEndpoint');
            const savedServerKey = sessionStorage.getItem('serverKey');

            if (savedEndpoint) {
                document.getElementById('apiEndpoint').value = savedEndpoint;
                apiEndpoint = savedEndpoint;
            }

            if (savedServerKey) {
                document.getElementById('serverKey').value = savedServerKey;
                currentServerKey = savedServerKey;
            }

            // Initialize time display
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            // Check if we should show Discord popup
            const discordShown = localStorage.getItem('discordPopupShown');
            if (!discordShown) {
                setTimeout(() => {
                    document.getElementById('discordPopup').style.display = 'block';
                    localStorage.setItem('discordPopupShown', 'true');
                }, 3000);
            }

            // Auto-login if we have saved credentials
            if (savedEndpoint && savedServerKey) {
                setTimeout(validateAndLogin, 500);
            }

            // Initialize hash routing
            initializeHashRouting();

            // Attach event listeners
            attachEventListeners();
        });
        // Add these functions to the JavaScript section

        // Load API Keys
        async function loadApiKeys() {
            try {
                const response = await apiCall('/api/admin/apiKeys');
                const tbody = document.getElementById('apiKeysTableBody');
                tbody.innerHTML = '';

                if (response.length === 0) {
                    tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-key"></i> No API keys found. Generate your first API key.
                    </td>
                </tr>
            `;
                    return;
                }

                response.forEach(apiKey => {
                    const created = apiKey.createdAt ?
                        new Date(apiKey.createdAt).toLocaleDateString('en-IN') : 'Unknown';

                    const expires = apiKey.expiresAt ?
                        new Date(apiKey.expiresAt).toLocaleDateString('en-IN') : 'Never';

                    const isExpired = apiKey.expiresAt && new Date(apiKey.expiresAt) < new Date();
                    const isActive = apiKey.isActive && !isExpired;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${escapeHtml(apiKey.name || 'Unnamed Key')}</td>
                <td>
                    <div class="api-key-cell" title="Click to copy" onclick="copyApiKey('${apiKey.key}')">
                        ${apiKey.key.substring(0, 8)}...${apiKey.key.substring(apiKey.key.length - 8)}
                    </div>
                </td>
                <td>
                    <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                        ${apiKey.permissions?.map(perm =>
                        `<span style="background: var(--bg-primary); padding: 2px 6px; border-radius: 4px; font-size: 11px;">${escapeHtml(perm)}</span>`
                    ).join('') || 'None'}
                    </div>
                </td>
                <td>${apiKey.rateLimit || 100}</td>
                <td>${created}</td>
                <td>${expires}</td>
                <td>
                    <span class="status-badge ${isActive ? 'status-active' : isExpired ? 'status-expired' : 'status-revoked'}">
                        <i class="fas fa-${isActive ? 'check' : isExpired ? 'clock' : 'times'}"></i>
                        ${isActive ? 'Active' : isExpired ? 'Expired' : 'Revoked'}
                    </span>
                </td>
                <td>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-info btn-xs" onclick="viewApiKey('${apiKey.key}')" title="View Details">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-danger btn-xs" onclick="deleteApiKey('${apiKey.key}', '${apiKey.name || 'this key'}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                showToast(`Failed to load API keys: ${error.message}`, 'error');
            }
        }

        // View API Key Details
        async function viewApiKey(key) {
            try {
                const response = await apiCall(`/api/admin/apiKeys/${key}`);

                // Create modal to show API key details
                const modal = document.createElement('div');
                modal.className = 'api-key-modal';
                modal.innerHTML = `
            <div class="api-key-modal-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: var(--text-primary);">
                        <i class="fas fa-key"></i> API Key Details
                    </h3>
                    <button onclick="this.closest('.api-key-modal').remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-secondary); font-size: 14px;">Key Name</label>
                    <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary);">
                        ${escapeHtml(response.name || 'Unnamed Key')}
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-secondary); font-size: 14px;">Full API Key</label>
                    <div class="api-key-display">
                        ${response.key}
                    </div>
                    <button class="copy-btn" onclick="copyApiKey('${response.key}')">
                        <i class="fas fa-copy"></i> Copy to Clipboard
                    </button>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: var(--text-secondary); font-size: 14px;">Permissions</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;">
                        ${response.permissions?.map(perm =>
                    `<span style="background: var(--primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${escapeHtml(perm)}</span>`
                ).join('') || '<span style="color: var(--text-secondary);">No permissions</span>'}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="color: var(--text-secondary); font-size: 14px;">Rate Limit</label>
                        <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary); text-align: center;">
                            ${response.rateLimit || 100} / 15min
                        </div>
                    </div>
                    <div>
                        <label style="color: var(--text-secondary); font-size: 14px;">Created</label>
                        <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary); text-align: center;">
                            ${response.createdAt ? new Date(response.createdAt).toLocaleDateString('en-IN') : 'Unknown'}
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--text-secondary); font-size: 14px;">Expires</label>
                    <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary); text-align: center;">
                        ${response.expiresAt ? new Date(response.expiresAt).toLocaleDateString('en-IN') : 'Never'}
                    </div>
                </div>
                
                <div class="warning-text">
                    <i class="fas fa-exclamation-triangle"></i>
                    This is the only time the full API key will be displayed. Save it securely.
                </div>
            </div>
        `;

                document.body.appendChild(modal);
                modal.style.display = 'flex';

            } catch (error) {
                showToast(`Failed to load API key details: ${error.message}`, 'error');
            }
        }

        // Copy API Key to Clipboard
        async function copyApiKey(key) {
            try {
                await navigator.clipboard.writeText(key);
                showToast('API key copied to clipboard!', 'success');
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = key;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('API key copied to clipboard!', 'success');
            }
        }

        // Delete API Key
        async function deleteApiKey(key, name) {
            if (!confirm(`Are you sure you want to delete API key "${name}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await apiCall(`/api/admin/apiKeys/${key}`, {
                    method: 'DELETE'
                });

                if (response.success) {
                    showToast('API key deleted successfully', 'success');
                    loadApiKeys();
                }
            } catch (error) {
                showToast(`Failed to delete API key: ${error.message}`, 'error');
            }
        }

        // Generate New API Key
        async function generateApiKey() {
            const name = document.getElementById('apiKeyName').value.trim() ||
                `API Key ${new Date().toLocaleDateString('en-IN')}`;

            const rateLimit = parseInt(document.getElementById('apiKeyRateLimit').value) || 100;
            const expiryDays = parseInt(document.getElementById('apiKeyExpiryDays').value) || 30;

            // Collect permissions
            const permissions = ['public_query']; // Always include public_query

            if (document.getElementById('permReadUsers').checked) {
                permissions.push('read_users');
            }

            if (document.getElementById('permReadStats').checked) {
                permissions.push('read_stats');
            }

            if (rateLimit < 10 || rateLimit > 1000) {
                showToast('Rate limit must be between 10 and 1000', 'error');
                return;
            }

            if (expiryDays < 1 || expiryDays > 365) {
                showToast('Expiry days must be between 1 and 365', 'error');
                return;
            }

            try {
                const response = await apiCall('/api/admin/generateApiKey', {
                    method: 'POST',
                    body: JSON.stringify({
                        name,
                        permissions,
                        rateLimit,
                        expiresInDays: expiryDays
                    })
                });

                if (response.success) {
                    showToast('API key generated successfully!', 'success');

                    // Reset form
                    document.getElementById('apiKeyName').value = '';
                    document.getElementById('apiKeyRateLimit').value = '100';
                    document.getElementById('apiKeyExpiryDays').value = '30';
                    document.getElementById('permReadUsers').checked = false;
                    document.getElementById('permReadStats').checked = false;

                    // Show the API key in a modal
                    const modal = document.createElement('div');
                    modal.className = 'api-key-modal';
                    modal.innerHTML = `
                <div class="api-key-modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--text-primary);">
                            <i class="fas fa-key"></i> API Key Generated
                        </h3>
                        <button onclick="this.closest('.api-key-modal').remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--text-secondary); font-size: 14px;">Key Name</label>
                        <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary);">
                            ${escapeHtml(name)}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--text-secondary); font-size: 14px;">Your API Key</label>
                        <div class="api-key-display">
                            ${response.apiKey}
                        </div>
                        <button class="copy-btn" onclick="copyApiKey('${response.apiKey}')">
                            <i class="fas fa-copy"></i> Copy to Clipboard
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--text-secondary); font-size: 14px;">Permissions</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;">
                            ${permissions.map(perm =>
                        `<span style="background: var(--primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${escapeHtml(perm)}</span>`
                    ).join('')}
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="color: var(--text-secondary); font-size: 14px;">Rate Limit</label>
                            <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary); text-align: center;">
                                ${rateLimit} / 15min
                            </div>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); font-size: 14px;">Expires</label>
                            <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; margin-top: 5px; color: var(--text-primary); text-align: center;">
                                ${new Date(response.expiresAt).toLocaleDateString('en-IN')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="warning-text">
                        <i class="fas fa-exclamation-triangle"></i>
                        This is the only time your API key will be shown. Save it securely!
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="this.closest('.api-key-modal').remove(); loadApiKeys();">
                            <i class="fas fa-check"></i> Done
                        </button>
                    </div>
                </div>
            `;

                    document.body.appendChild(modal);
                    modal.style.display = 'flex';

                    // Load updated API keys list
                    setTimeout(loadApiKeys, 1000);
                }
            } catch (error) {
                showToast(`Failed to generate API key: ${error.message}`, 'error');
            }
        }

        // Update the page data loading function
        function loadPageData(page) {
            switch (page) {
                case 'home':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'licenses':
                    loadLicenses();
                    break;
                case 'serverkeys':
                    loadServerKeys();
                    break;
                case 'stats':
                    loadStatsData();
                    break;
                case 'system':
                    loadSystemInfo();
                    break;
                case 'email':
                    // Email functions already handled
                    break;
                case 'api':
                    loadApiKeys(); // Load API keys when API tab is opened
                    break;
            }
        }

        // Add event listeners for API key management
        function attachEventListeners() {
            // Existing listeners...

            // API Key Management
            document.getElementById('refreshApiKeysBtn')?.addEventListener('click', loadApiKeys);
            document.getElementById('createApiKeyBtn')?.addEventListener('click', generateApiKey);

            // Update the generate button in API tab
            const oldGenerateBtn = document.getElementById('generateApiKeyBtn');
            if (oldGenerateBtn) {
                oldGenerateBtn.addEventListener('click', generateApiKey);
            }
        }

        // Also update the attachEventListeners function to include:
        document.getElementById('refreshApiKeysBtn')?.addEventListener('click', loadApiKeys);
        document.getElementById('createApiKeyBtn')?.addEventListener('click', generateApiKey);
        function updateCurrentTime() {
            const now = new Date();
            const indianTime = now.toLocaleString('en-IN', {
                timeZone: 'Asia/Kolkata',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            document.getElementById('currentTime').textContent = indianTime;
        }

        function initializeHashRouting() {
            // Handle initial hash
            const hash = window.location.hash.substring(1) || 'home';
            navigateToPage(hash);

            // Handle hash changes
            window.addEventListener('hashchange', function () {
                const hash = window.location.hash.substring(1) || 'home';
                navigateToPage(hash);
            });
        }

        function navigateToPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(el => {
                el.classList.remove('active');
            });

            // Update navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected page
            const pageElement = document.getElementById(`page-${page}`);
            if (pageElement) {
                pageElement.classList.add('active');

                // Update page title
                const pageTitle = pageElement.querySelector('h1')?.textContent || 'Dashboard';
                document.getElementById('pageTitle').textContent = pageTitle;

                // Update active nav link
                const navLink = document.querySelector(`[data-page="${page}"]`);
                if (navLink) {
                    navLink.classList.add('active');
                }

                // Load page data
                loadPageData(page);
            }

            // Close mobile menu if open
            document.getElementById('sidebar').classList.remove('active');
        }

        function loadPageData(page) {
            switch (page) {
                case 'home':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'licenses':
                    loadLicenses();
                    break;
                case 'serverkeys':
                    loadServerKeys();
                    break;
                case 'stats':
                    loadStatsData();
                    break;
                case 'system':
                    loadSystemInfo();
                    break;
            }
        }

        function attachEventListeners() {
            // Login/Logout
            document.getElementById('loginBtn')?.addEventListener('click', login);
            document.getElementById('logoutBtn')?.addEventListener('click', logout);
            document.getElementById('closeDiscordPopup')?.addEventListener('click', () => {
                document.getElementById('discordPopup').style.display = 'none';
            });

            // Mobile menu
            document.getElementById('mobileMenuBtn')?.addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('active');
            });

            // Users
            document.getElementById('refreshUsersBtn')?.addEventListener('click', () => {
                loadUsers(currentPage);
            });

            // Email functions
            document.getElementById('setmailBtn')?.addEventListener('click', setUserEmail);
            document.getElementById('requestOTPBtn')?.addEventListener('click', requestOTP);
            document.getElementById('verifyOTPBtn')?.addEventListener('click', verifyOTP);
            document.getElementById('generateApiKeyBtn')?.addEventListener('click', generateApiKey);

            // Enter key for login
            document.getElementById('serverKey')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                const sidebar = document.getElementById('sidebar');
                const menuBtn = document.getElementById('mobileMenuBtn');
                if (window.innerWidth <= 1024 && sidebar.classList.contains('active') &&
                    !sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });
        }

        // API Helper
        async function apiCall(endpoint, options = {}) {
            const url = `${apiEndpoint}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'server-key': currentServerKey
                }
            };

            const finalOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...(options.headers || {})
                }
            };

            try {
                const response = await fetch(url, finalOptions);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }

                return data;
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Authentication
        async function login() {
            const serverKey = document.getElementById('serverKey').value.trim();
            const endpoint = document.getElementById('apiEndpoint').value.trim();

            if (!serverKey) {
                showToast('Please enter a server key', 'error');
                return;
            }

            if (!endpoint) {
                showToast('Please enter API endpoint', 'error');
                return;
            }

            apiEndpoint = endpoint;
            currentServerKey = serverKey;
            setLoading(true, 'loginBtn');

            try {
                const response = await fetch(`${apiEndpoint}/api/validateToken`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: serverKey })
                });

                const data = await response.json();

                if (data.valid && data.pluginEnabled) {
                    sessionStorage.setItem('serverKey', serverKey);
                    sessionStorage.setItem('apiEndpoint', endpoint);

                    document.getElementById('login').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    showToast('Login successful!', 'success');

                    document.getElementById('serverStatus').textContent = 'Online';

                    loadDashboardData();

                    setTimeout(() => {
                        document.getElementById('discordPopup').style.display = 'block';
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Invalid server key or plugin disabled');
                }
            } catch (error) {
                showToast(`Login failed: ${error.message}`, 'error');
            } finally {
                setLoading(false, 'loginBtn');
            }
        }

        async function validateAndLogin() {
            try {
                const response = await fetch(`${apiEndpoint}/api/validateToken`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: currentServerKey })
                });

                const data = await response.json();

                if (data.valid && data.pluginEnabled) {
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    document.getElementById('serverStatus').textContent = 'Online';
                    loadDashboardData();
                }
            } catch (error) {
                logout();
            }
        }

        function logout() {
            currentServerKey = '';
            apiEndpoint = '';

            sessionStorage.removeItem('serverKey');
            sessionStorage.removeItem('apiEndpoint');

            document.getElementById('login').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
            showToast('Logged out successfully', 'info');
        }

        // Dashboard Data
        async function loadDashboardData() {
            try {
                const response = await apiCall('/api/stats');

                document.getElementById('totalUsers').textContent = response.totalUsers || 0;
                document.getElementById('loggedInToday').textContent = response.loggedInToday || 0;
                document.getElementById('newRegistrations').textContent = response.registrationsLast30Days || 0;
                document.getElementById('bannedUsers').textContent = response.bannedUsers || 0;

                if (response.last24hData) {
                    createLoginChart24h(response.last24hData);
                }

                if (response.registrationData) {
                    createRegistrationChart(response.registrationData);
                }

            } catch (error) {
                showToast(`Failed to load dashboard: ${error.message}`, 'error');
            }
        }

        async function loadStatsData() {
            try {
                const response = await apiCall('/api/enhancedStats');

                document.getElementById('peakHour').textContent = response.peakLoginHour + ':00';
                document.getElementById('retentionRate').textContent = response.retentionRate || '0%';
                document.getElementById('cacheHit').textContent = response.cached ? '95%' : '85%';

                if (response.last7dData) {
                    createWeeklyChart(response.last7dData);
                }

                if (response.last30dData) {
                    createMonthlyChart(response.last30dData);
                }

            } catch (error) {
                showToast(`Failed to load stats: ${error.message}`, 'error');
            }
        }

        // Users Management
        async function loadUsers(page = 1) {
            try {
                const response = await apiCall(`/api/admin/users?page=${page}&limit=50`);
                userData = response.users || [];

                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';

                userData.forEach(user => {
                    const lastLogin = user.lastLogin ?
                        new Date(user.lastLogin).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }) : 'Never';
                    const createdAt = user.createdAt ?
                        new Date(user.createdAt).toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }) : 'Unknown';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${escapeHtml(user.username)}</td>
                        <td>${escapeHtml(user.email || 'N/A')}</td>
                        <td>${createdAt}</td>
                        <td>${lastLogin}</td>
                        <td>
                            <span class="status-badge ${user.isBanned ? 'status-banned' : 'status-active'}">
                                <i class="fas fa-${user.isBanned ? 'ban' : 'check'}"></i>
                                ${user.isBanned ? 'Banned' : 'Active'}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-warning btn-xs" onclick="showPasswordModal('${escapeHtml(user.username)}')">
                                    <i class="fas fa-key"></i>
                                </button>
                                <button class="btn btn-${user.isBanned ? 'success' : 'warning'} btn-xs" 
                                        onclick="${user.isBanned ? 'unbanUser' : 'banUser'}('${escapeHtml(user.username)}')">
                                    <i class="fas fa-${user.isBanned ? 'unlock' : 'ban'}"></i>
                                </button>
                                <button class="btn btn-danger btn-xs" onclick="deleteUser('${escapeHtml(user.username)}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                updatePagination('usersPagination', page, response.totalPages || 1, loadUsers);
                currentPage = page;

            } catch (error) {
                showToast(`Failed to load users: ${error.message}`, 'error');
            }
        }

        // Licenses Management
        async function loadLicenses() {
            try {
                const response = await apiCall('/api/admin/licenses');
                const tbody = document.getElementById('licensesTableBody');
                tbody.innerHTML = '';

                response.forEach(license => {
                    const validUntil = new Date(license.validUntil).toLocaleDateString('en-IN');
                    const isActive = new Date(license.validUntil) > new Date() && license.isActive;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${escapeHtml(license.key)}</td>
                        <td>${escapeHtml(license.type)}</td>
                        <td>${validUntil}</td>
                        <td>${license.maxServers === -1 ? 'Unlimited' : license.maxServers}</td>
                        <td>${license.usedServers?.length || 0}</td>
                        <td>
                            <span class="status-badge ${isActive ? 'status-active' : 'status-banned'}">
                                <i class="fas fa-${isActive ? 'check' : 'times'}"></i>
                                ${isActive ? 'Active' : 'Expired'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-danger btn-xs" onclick="deleteLicense('${escapeHtml(license.key)}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                showToast(`Failed to load licenses: ${error.message}`, 'error');
            }
        }

        // Server Keys Management
        async function loadServerKeys() {
            try {
                const response = await fetch(`${apiEndpoint}/api/admin/serverKeys`, {
                    headers: { 'server-key': currentServerKey }
                });
                const data = await response.json();

                const tbody = document.getElementById('serverKeysTableBody');
                tbody.innerHTML = '';

                data.forEach(server => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><code style="font-size: 11px;">${escapeHtml(server.key.substring(0, 20))}...</code></td>
                        <td>${escapeHtml(server.name)}</td>
                        <td>${escapeHtml(server.owner || 'N/A')}</td>
                        <td>${server.maxUsers === -1 ? 'Unlimited' : server.maxUsers}</td>
                        <td>${server.currentUsers || 0}</td>
                        <td>
                            <span class="status-badge ${server.isActive ? 'status-active' : 'status-banned'}">
                                <i class="fas fa-${server.isActive ? 'check' : 'times'}"></i>
                                ${server.isActive ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge ${server.pluginEnabled ? 'status-active' : 'status-banned'}">
                                <i class="fas fa-${server.pluginEnabled ? 'check' : 'times'}"></i>
                                ${server.pluginEnabled ? 'Enabled' : 'Disabled'}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

            } catch (error) {
                showToast(`Failed to load server keys: ${error.message}`, 'error');
            }
        }

        // System Info
        async function loadSystemInfo() {
            try {
                const response = await fetch(`${apiEndpoint}/api/system/info`);
                const data = await response.json();

                document.getElementById('systemVersion').textContent = data.version;
                document.getElementById('totalServers').textContent = data.totalServers;
                document.getElementById('systemUptime').textContent = formatUptime(data.uptime);
                document.getElementById('activeLicenses').textContent = data.activeLicenses;
                document.getElementById('systemTotalUsers').textContent = data.totalUsers;

            } catch (error) {
                showToast(`Failed to load system info: ${error.message}`, 'error');
            }
        }

        // Email Functions
        async function setUserEmail() {
            const username = document.getElementById('setmailUsername').value.trim();
            const email = document.getElementById('setmailEmail').value.trim();

            if (!username || !email) {
                showToast('Username and email are required', 'error');
                return;
            }

            try {
                const response = await fetch(`${apiEndpoint}/api/setmail`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username,
                        email,
                        serverKey: currentServerKey
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Email updated successfully', 'success');
                    document.getElementById('setmailUsername').value = '';
                    document.getElementById('setmailEmail').value = '';
                } else {
                    showToast(data.error || 'Failed to update email', 'error');
                }
            } catch (error) {
                showToast('Failed to update email', 'error');
            }
        }

        async function requestOTP() {
            const email = document.getElementById('resetEmail').value.trim();

            if (!email) {
                showToast('Please enter email address', 'error');
                return;
            }

            setLoading(true, 'requestOTPBtn');

            try {
                const response = await fetch(`${apiEndpoint}/api/changePassword/requestOTP`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('OTP sent to email', 'success');
                    document.getElementById('otpSection').style.display = 'block';
                } else {
                    showToast(data.error || 'Failed to send OTP', 'error');
                }
            } catch (error) {
                showToast('Failed to send OTP', 'error');
            } finally {
                setLoading(false, 'requestOTPBtn');
            }
        }

        async function verifyOTP() {
            const email = document.getElementById('resetEmail').value.trim();
            const otp = document.getElementById('otpCode').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();

            if (!otp || !newPassword) {
                showToast('OTP and new password are required', 'error');
                return;
            }

            setLoading(true, 'verifyOTPBtn');

            try {
                const response = await fetch(`${apiEndpoint}/api/changePassword/verifyOTP`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, otp, newPassword })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Password changed successfully', 'success');
                    document.getElementById('otpSection').style.display = 'none';
                    document.getElementById('resetEmail').value = '';
                    document.getElementById('otpCode').value = '';
                    document.getElementById('newPassword').value = '';
                } else {
                    showToast(data.error || 'Failed to change password', 'error');
                }
            } catch (error) {
                showToast('Failed to change password', 'error');
            } finally {
                setLoading(false, 'verifyOTPBtn');
            }
        }

        async function generateApiKey() {
            const name = document.getElementById('apiKeyName').value.trim() || `API Key ${new Date().toLocaleDateString('en-IN')}`;

            try {
                const response = await apiCall('/api/admin/generateApiKey', {
                    method: 'POST',
                    body: JSON.stringify({
                        name,
                        permissions: ['public_query'],
                        rateLimit: 100,
                        expiresInDays: 30
                    })
                });

                if (response.success) {
                    showToast('API key generated successfully', 'success');
                    document.getElementById('apiKeyName').value = '';

                    // Show the API key to user
                    alert(`API Key: ${response.apiKey}\n\nSave this key securely. It will not be shown again.`);
                } else {
                    showToast('Failed to generate API key', 'error');
                }
            } catch (error) {
                showToast('Failed to generate API key', 'error');
            }
        }

        // Chart Functions
        function createLoginChart24h(data) {
            const ctx = document.getElementById('loginChart24h');
            if (!ctx || !window.Chart) return;

            if (charts.login24h) {
                charts.login24h.destroy();
            }

            charts.login24h = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.period),
                    datasets: [{
                        label: 'Logins',
                        data: data.map(d => d.count),
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function createRegistrationChart(data) {
            const ctx = document.getElementById('registrationChart');
            if (!ctx || !window.Chart) return;

            if (charts.registration) {
                charts.registration.destroy();
            }

            charts.registration = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.period),
                    datasets: [{
                        label: 'Registrations',
                        data: data.map(d => d.count),
                        backgroundColor: '#10b981',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function createWeeklyChart(data) {
            const ctx = document.getElementById('weeklyChart');
            if (!ctx || !window.Chart) return;

            if (charts.weekly) {
                charts.weekly.destroy();
            }

            charts.weekly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.period),
                    datasets: [{
                        label: 'Logins',
                        data: data.map(d => d.count),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function createMonthlyChart(data) {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx || !window.Chart) return;

            if (charts.monthly) {
                charts.monthly.destroy();
            }

            charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.period),
                    datasets: [{
                        label: 'Daily Logins',
                        data: data.map(d => d.count),
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Utility Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function setLoading(loading, buttonId) {
            const button = document.getElementById(buttonId);
            if (!button) return;

            if (loading) {
                button.disabled = true;
                const originalContent = button.innerHTML;
                button.dataset.originalContent = originalContent;
                button.innerHTML = '<div class="loading"></div> Loading...';
            } else {
                button.disabled = false;
                if (button.dataset.originalContent) {
                    button.innerHTML = button.dataset.originalContent;
                }
            }
        }

        function updatePagination(containerId, currentPage, totalPages, onPageClick) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';

            if (totalPages <= 1) return;

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'â€¹';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => onPageClick(currentPage - 1);
            container.appendChild(prevBtn);

            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'active' : '';
                pageBtn.onclick = () => onPageClick(i);
                container.appendChild(pageBtn);
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'â€º';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => onPageClick(currentPage + 1);
            container.appendChild(nextBtn);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);

            if (hours > 24) {
                const days = Math.floor(hours / 24);
                return `${days}d ${hours % 24}h`;
            }

            return `${hours}h ${minutes}m`;
        }

        // Admin Functions
        async function banUser(username) {
            if (!confirm(`Ban user ${username}?`)) return;

            try {
                const response = await apiCall('/api/admin/banUser', {
                    method: 'POST',
                    body: JSON.stringify({ username, banMessage: 'Banned by admin' })
                });

                showToast(`User ${username} banned`, 'success');
                loadUsers(currentPage);
            } catch (error) {
                showToast('Failed to ban user', 'error');
            }
        }

        async function unbanUser(username) {
            if (!confirm(`Unban user ${username}?`)) return;

            try {
                const response = await apiCall('/api/admin/unbanUser', {
                    method: 'POST',
                    body: JSON.stringify({ username })
                });

                showToast(`User ${username} unbanned`, 'success');
                loadUsers(currentPage);
            } catch (error) {
                showToast('Failed to unban user', 'error');
            }
        }

        async function deleteUser(username) {
            if (!confirm(`Delete user ${username}? This cannot be undone.`)) return;

            try {
                const response = await apiCall('/api/admin/deleteUser', {
                    method: 'POST',
                    body: JSON.stringify({ username })
                });

                showToast(`User ${username} deleted`, 'success');
                loadUsers(currentPage);
            } catch (error) {
                showToast('Failed to delete user', 'error');
            }
        }

        async function deleteLicense(key) {
            if (!confirm(`Delete license ${key}?`)) return;

            try {
                const response = await apiCall(`/api/admin/licenses/${key}`, {
                    method: 'DELETE'
                });

                showToast('License deleted', 'success');
                loadLicenses();
            } catch (error) {
                showToast('Failed to delete license', 'error');
            }
        }

        function showPasswordModal(username) {
            const newPassword = prompt(`Enter new password for ${username}:`);
            if (!newPassword) return;

            changePassword(username, newPassword);
        }

        async function changePassword(username, newPassword) {
            try {
                const response = await apiCall('/api/admin/changePassword', {
                    method: 'POST',
                    body: JSON.stringify({ username, newPassword })
                });

                showToast('Password changed successfully', 'success');
            } catch (error) {
                showToast('Failed to change password', 'error');
            }
        }

        function showCreateLicenseModal() {
            // Simplified modal for license creation
            const key = prompt('Enter license key (leave blank to generate):');
            const type = prompt('Enter license type (GLOBAL/SERVER_SPECIFIC):', 'GLOBAL');
            const validUntil = prompt('Enter expiry date (YYYY-MM-DD):', '2026-12-31');

            if (key !== null && type && validUntil) {
                createLicense(key || '', type, validUntil);
            }
        }

        async function createLicense(key, type, validUntil) {
            try {
                const response = await apiCall('/api/admin/licenses', {
                    method: 'POST',
                    body: JSON.stringify({
                        key: key || undefined,
                        type,
                        validUntil,
                        maxServers: -1
                    })
                });

                showToast('License created successfully', 'success');
                loadLicenses();
            } catch (error) {
                showToast('Failed to create license', 'error');
            }
        }
    </script>
</body>

</html>